<!doctype html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <title>Registro de Usuarios</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <style>
        body { font-family: system-ui, Arial; max-width: 720px; margin: 24px auto; padding: 20px; }
        form, ul { margin-top: 16px; }
        input, button { padding: 8px; margin: 4px; border: 1px solid #ddd; border-radius: 4px; }
        input { width: 200px; }
        button { background: #007bff; color: white; cursor: pointer; }
        button:hover { background: #0056b3; }
        li { margin: 8px 0; padding: 8px; background: #f9f9f9; border-radius: 4px; }
        .success { color: green; background: #e8f5e8; padding: 10px; border-radius: 4px; }
        .error { color: red; background: #ffe8e8; padding: 10px; border-radius: 4px; }
        .loading { color: #666; }
    </style>
</head>
<body>
    <h1>üìã Sistema de Registro de Usuarios</h1>

    <form id="userForm">
        <input name="name" placeholder="Nombre completo" required />
        <input name="email" type="email" placeholder="Email" required />
        <input name="phone" placeholder="Tel√©fono" required />
        <button type="submit">Crear Usuario</button>
    </form>

    <div id="message"></div>

    <h2>üë• Usuarios Registrados</h2>
    <div id="usersList" class="loading">Cargando usuarios...</div>

    <script>
        console.log("‚úÖ JavaScript cargado correctamente");

        // Funci√≥n para cargar usuarios
        async function loadUsers() {
            console.log("üîÑ Cargando usuarios...");
            try {
                const response = await fetch('/api/users/list/');
                console.log("üì° Respuesta recibida:", response.status);
                
                if (!response.ok) {
                    throw new Error(`Error HTTP: ${response.status}`);
                }
                
                const users = await response.json();
                console.log("üìä Usuarios cargados:", users);
                
                const usersList = document.getElementById('usersList');
                
                if (users.length === 0) {
                    usersList.innerHTML = '<p>No hay usuarios registrados</p>';
                    return;
                }
                
                usersList.innerHTML = users.map(user => 
                    `<div><strong>${user.name}</strong> - ${user.email} - ${user.phone}</div>`
                ).join('');
                
            } catch (error) {
                console.error('‚ùå Error cargando usuarios:', error);
                document.getElementById('usersList').innerHTML = 
                    `<p class="error">Error cargando usuarios: ${error.message}</p>`;
            }
        }

        // Funci√≥n para crear usuario
        async function createUser(userData) {
            console.log("üîÑ Creando usuario:", userData);
            try {
                const response = await fetch('/api/users/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(userData)
                });
                
                console.log("üì° Respuesta creaci√≥n:", response.status);
                const result = await response.json();
                
                return { success: response.ok, data: result };
                
            } catch (error) {
                console.error('‚ùå Error creando usuario:', error);
                return { success: false, error: error.message };
            }
        }

        // Manejar env√≠o del formulario
        document.getElementById('userForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            console.log("üîÑ Formulario enviado");
            
            const formData = new FormData(e.target);
            const userData = {
                name: formData.get('name'),
                email: formData.get('email'),
                phone: formData.get('phone')
            };

            // Validaci√≥n simple
            if (!userData.name || !userData.email || !userData.phone) {
                showMessage('‚ùå Todos los campos son requeridos', 'error');
                return;
            }

            showMessage('‚è≥ Creando usuario...', 'loading');

            const result = await createUser(userData);

            if (result.success) {
                showMessage('‚úÖ Usuario creado exitosamente! Notificaci√≥n enviada.', 'success');
                e.target.reset();
                loadUsers();
            } else {
                showMessage(`‚ùå Error: ${result.data?.error || result.error}`, 'error');
            }
        });

        // Funci√≥n para mostrar mensajes
        function showMessage(text, type) {
            const messageDiv = document.getElementById('message');
            messageDiv.innerHTML = `<div class="${type}">${text}</div>`;
            
            if (type !== 'loading') {
                setTimeout(() => {
                    messageDiv.innerHTML = '';
                }, 5000);
            }
        }

        // Cargar usuarios al iniciar
        console.log("üöÄ Iniciando aplicaci√≥n...");
        loadUsers();
    </script>
</body>
</html>
